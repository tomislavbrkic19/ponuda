@model PagedList.IPagedList<Ponuda.Models.Ponude>
@using PagedList.Mvc;
@{
    ViewBag.Title = "Index";
}
<script src="~/Scripts/jquery-1.12.4.js"></script>

<style>
    table {
        width: 100%;
    }

    /*table tr td, th {
            border: 2px solid black;
            text-align: center;
            word-wrap: break-word;
        }

        table tr:hover, table th:hover {
            background-color: #000;
            color: #fff;
        }

        table tr th {
            border: 2px solid black;
            text-align: center;
            background-color: #fff;
            color: #000;
        }*/

    .table-wrapper-scroll-y {
        display: block;
        max-height: 600px;
        overflow-y: auto;
        -ms-overflow-style: -ms-autohiding-scrollbar;
    }
</style>
<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>


<div class="row">
    <div class="col-md-4">

        <div class="table-wrapper-scroll-y">

            <table class="table table-striped table-bordered table-hover" id="tblPonudeList">
                <tr>
                    <th>
                        Ponuda ID @*@Html.DisplayNameFor(model => model.PonudaID)*@
                    </th>
                    <th>
                        Datum  @*@Html.DisplayNameFor(model => model.UkupnaCijena)*@
                    </th>
                    <th>
                        Cijena @*@Html.DisplayNameFor(model => model.DatumPonude)*@
                    </th>

                </tr>

                @foreach (var item in Model)
                {
                    <tr>
                        <th>
                            @Html.DisplayFor(model => item.PonudaID)
                        </th>
                        <td>
                            @Html.DisplayFor(modelItem => item.DatumPonude)
                        </td>
                        <td>
                            @*<a href="#" data-toggle="onclick" data-trigger="onclick" id="@item.PonudaID" onclick="loadPonuda(id);">@item.UkupnaCijena</a>*@
                            @Html.DisplayFor(modelItem => item.UkupnaCijena)@*<a onclick="loadPonuda(@item.PonudaID);">@item.UkupnaCijena</a>*@
                            @*<td>
                                    @Html.ActionLink("Edit", "Edit", new { id = item.PonudaID }) |
                                    @Html.ActionLink("Details", "Details", new { id = item.PonudaID }) |
                                    @Html.ActionLink("Delete", "Delete", new { id = item.PonudaID })
                                </td>*@
                    </tr>

                }


            </table>
        </div>
        <br />
        <div id='Paging' style="text-align:center">
            Stranica @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)
            od @Model.PageCount

            @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))
        </div>
    </div>
    <div class="col-md-8">
        <div class="row" style="height:100px">
            <div class="col-md-4">
                Broj ponude:
                <input type="text" id="PonudaId" disabled>

            </div>
            <div class="col-md-4">
                Datum ponude:
                <input type="text" id="DatumPonude" disabled>

            </div>
            <div class="col-md-4">
                <a href='#' class='btn btn-sm btn-success' onclick='PonudaSave()'>Spremi ponudu</a>
            </div>
        </div>
        <div class="row">
           
            Sadržaj ponude
            <div class="table-responsive">
                <table id="tblPonudaDetails" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Naziv stavke</th>
                            <th>Jedinična cijena</th>
                            <th>Količina</th>
                            <th>Ukupno</th>
                            <th>Uredi</th>
                            <th>Brisanje</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                    </tfoot>

                </table>
            </div>
            <div class="col-md-4 right">
                Ukupni iznos ponude:
                <input type="text" id="UkupnaCijenaPonude" disabled>

            </div>
        </div>


    </div>
</div>
<!--MODAL za Edit STAVKE-->
    <div class="modal fade" id="MyModal">
        @*<div class="modal-dialog">
            <div class="modal-content">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <div class="modal-header">

                    <h4 id="ModalTitle"></h4>
                </div>
                <div class="modal-body">
                    <form id="form">
                        <fieldset id="SubmitForm">
                            <div class="form-group">
                                Artikal: <input id="Artikal" class="nummask" type="text" name="Artikal" required><br>
                            </div>
                            <div class="form-group">
                                Jedinična cijena: <input id="JedcijenaArtikla" name="JedcijenaArtikla"><br>
                            </div>
                            <div class="form-group">
                                Količina: <input id="Kolicina" type="number" name="Kolicina" pattern="[A-Za-z]{3}" title="Three letter country code"><br>
                            </div>
                            <div class="form-group">
                                ukupna cijena: <input id="UkupnaCijenaStavke" type="text" name="UkupnaCijenaStavke"><br>
                            </div>
                           
                            <div class="form-group">
                                <a href="#" onclick='SaveAdminStatus()' class="btn btn-block btn-danger" id="SaveStudentRecord">Save</a>
                            </div>

                        </fieldset>
                    </form>
                </div>
            </div>
        </div>*@
    </div>


    <script>
        //Decimal Number
        //$(document).on("input", ".nummask", function (e) {
        //    this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
        //});
        $(document).ready(function () {


            $("#tblPonudeList tr").click(function () {
                var tableData = $(this).children("th").map(function () {
                    loadPonuda($(this).text());
                }).get();
            });


            function setData(id) {

                var set_data = '';
                var element = $(this);
                var id = element.attr("id");
                $.ajax({
                    url: "/Ponude/Details/" + id,
                    method: "post",
                    async: false,
                    data: { id: id },
                    success: function (data) {
                        set_data = data;
                    }

                });
                return set_data;
            }
        });
        function loadPonuda(id) {
            $.ajax({
                url: '/api/Data/' + id,
                dataType: "json",
                type: "Get",
                async: false,
                success: function (data) {


                    console.log('Loaded data for id:' + id);
                    console.log(data);
                    populateFields(data);
                },
                error: function (xhr) {
                    alert('No Valid Data');
                }
            });

        };
        function populateFields(data) {

            $("#DatumPonude").val(data[0].DatumPonude);
            $("#PonudaId").val(data[0].PonudaID);
            $("#UkupnaCijenaPonude").val(data[0].UkupnaCijena);
            $("#tblPonudaDetails > TBODY").empty();
            var tBody = $("#tblPonudaDetails > TBODY")[0];

            for (var i = 0; i < data[0].Stavke.length; i++) {
                var StavkaNaziv = data[0].Stavke[i].Artikli.NazivArtikla;
                var StavkaJedCijena = data[0].Stavke[i].Artikli.JedCijenaArtikla;
                var StavkaKolicina = data[0].Stavke[i].Kolicina;
                var StavkaUkupnaCijena = data[0].Stavke[i].UkupnaCijenaStavke;
                var StavkaID = data[0].Stavke[i].StavkaId;



                //Add Row.
                var row = tBody.insertRow(-1);

                cell = $(row.insertCell(-1));
                var labelStavka = document.createElement("input");
                labelStavka.setAttribute("disabled", "disabled");
                labelStavka.className = "form-control";
                labelStavka.value = StavkaNaziv;
                cell.append(labelStavka);

                cell = $(row.insertCell(-1));
                var labelStavkaJedCijena = document.createElement("input");
                labelStavkaJedCijena.setAttribute("disabled", "disabled");
                labelStavkaJedCijena.className = "form-control";
                labelStavkaJedCijena.value = StavkaJedCijena;
                cell.append(labelStavkaJedCijena);

                cell = $(row.insertCell(-1));
                var labelStavkaKolicina = document.createElement("input");
                labelStavkaKolicina.setAttribute("disabled", "disabled");
                labelStavkaKolicina.className = "form-control";
                labelStavkaKolicina.value = StavkaKolicina;
                cell.append(labelStavkaKolicina);

                cell = $(row.insertCell(-1));
                var labelStavkaUkupnaCijena = document.createElement("input");
                labelStavkaUkupnaCijena.setAttribute("disabled", "disabled");
                labelStavkaUkupnaCijena.className = "form-control";
                labelStavkaUkupnaCijena.value = StavkaUkupnaCijena;
                cell.append(labelStavkaUkupnaCijena);

                //Add Edit Button cell.
                cell = $(row.insertCell(-1));
                var btnEdit = $("<input />");
                btnEdit.attr("class", "btn btn-sm btn-success");
                btnEdit.attr("type", "button");
                btnEdit.attr("onclick", "StavkaEdit(" + StavkaID + ");");
                btnEdit.val("Uredi");
                cell.append(btnEdit);

                //Add Remove Button cell.
                cell = $(row.insertCell(-1));
                var btnRemove = $("<input />");
                btnRemove.attr("class", "btn btn-sm btn-danger");
                btnRemove.attr("type", "button");
                btnRemove.attr("onclick", "Remove(this,\"tblPonudaDetails\");");
                btnRemove.val("Remove");
                cell.append(btnRemove);




            };

        };
        function Remove(button, tableName) {

            var row = $(button).closest("TR");

            if (confirm("Da li želite obrisati stavku")) {
                //Get the reference of the Table.
                console.log('tableName' + tableName);
                var table = $("#" + tableName)[0];
                //Delete the Table row using it's Index.
                table.deleteRow(row[0].rowIndex);
            }
        };
        function StavkaEdit(StavkaID) {

            // var StavakaID = $("#PonudaId").val();
            console.log('StavkaID=' + StavkaID);
            //var url = "/api/Data/GetStavkaById?StavkaId=" + StavkaID;
            var url = "/Ponude/StavkaEdit/" + StavkaID;
          

            $.get(url, function (partialView) {
                $("#MyModal").html(partialView);
                $("#MyModal").modal();
            });


            //$("#ModalTitle").html("Ažuriranje stavke");
            //$("#MyModal").modal();
            //$.ajax({
            //    type: "GET",
            //    url: url,
            //    success: function (data) {
            //        var obj = data;
            //        console.log(obj);
            //        // console.log(data.Kolicina);

            //        $("#JedcijenaArtikla").val(data.Artikli.JedCijenaArtikla);
            //        $("#UkupnaCijenaStavke").val(data.UkupnaCijenaStavke);
            //        $("#Kolicina").val(data.Kolicina);


            //        $("#JedcijenaArtikla").change(function () {
            //            this.value = parseFloat(this.value).toFixed(2);
            //        });
            //    }
            //});
            //$(".nummask").inputmask('Regex', { regex: "^[0-9]{1,6}(\\.\\d{1,2})?$" });
        };
        function PonudaSave() {

        };


    </script>


